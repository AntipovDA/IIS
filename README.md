## **Описание проекта:**
Целью данного проекта является прогнозирование цен на подержаные автомобили. Для данной задачи используется набор данных Car Price prediction: https://www.kaggle.com/datasets/vijayaadithyanvg/car-price-predictionused-cars/data

## **Запуск:**
```
git clone https://github.com/AntipovDA/IIS - клонирование репозитория
cd IIS - переход в склонированную папку
python3 -m venv .my_venv - установка виртуального окружения
source .my_venv/bin/activate - активация виртуального окружения
pip install -r requirements.txt - установкав в окружение всех требуемых библиотек
```
Запуск MlFlow:
```
cd mlflow - переход в папку со bash-скриптом, который запускает Mlflow
sh start_mlflow.sh - запуск mlflow
```
После запуска mlflow будет доступен по ссылке: http://localhost:5000/

## **Исследование данных:**
Находится в ```./eda/eda.ipynb.``` Основные результаты:
В ходе исследования был проведен анализ, который показал, что данные не обладают избыточностью, все записи валидны
В ходе анализа были выявлены следующие закономерности:

* Большая часть автомобилей продается через дилеров, а не частными лицами
* Преобладание механической коробки передач указывает на то, что в данных больше бюджетных моделей автомобилей, которые часто оснащаются механической трансмиссией
* Текущая цена автомобиля (Present_Price) является основным фактором, влияющим на цену его продажи (Selling_Price)
* Количество владельцев практически не влияет на остальные параметры, что может означать, что покупатели больше ориентируются на другие характеристики автомобиля, такие как текущая цена, пробег и возраст
* Большинство значений находится в нижнем диапазоне значений (до 15), что может указывать на преобладание автомобилей с низкой ценой.


## **Результаты исследования:**

Лучше всего показала себя модель 2 (RandonForestRegression) с трансформациями следующих столбцов входных данных: 

- к столбцам 'Selling_Price', 'Driven_kms' была применена полиномиальная функция PolynomialFeatures
- данные из столбцов 'Selling_Price', 'Driven_kms' были разбиты на 3 категории с помощью KBinsDiscretizer

Параметры модели: 

```
'n_estimators': 100
'max_depth': 20
'max_features': 0.8072727315456365
```

Результаты исследований приведены ниже: 

```
mae: 1,25
mape: 0,67
mse: 3,28
```
На вход модели подавались следующие признаки: 

```
 "Car_Name", "Selling_Price", "Driven_kms", "Fuel_Type", "Selling_type", "Transmission", "Owner"
```

Лучшая модель была обучена на всей выборке с тэгом Production. Run ID = 'c47d900173524e54a3c2d81582996146'

## **Описание разработанного сервиса:**
1. ml_service - содержит в себе следующие файлы:
    * Dockerfile - содержит инструкцию по сборке образа и запуску контейнера
    * api_handler.py - содержит класс-обработчик запросов к API FastAPIHandler, который загружает обученную модель, принимает входные данные и выполняет предсказание с помощью загруженной модели
    * main.py - содержит скрипт, который разворачивает сервис для взаимодействия с моделью машинного обучения через API
    * requirements.txt - хранит зависимости, которые необходимы для работы сервиса


2. models - содержит в себе следующие файлы:
    * get_model.py - скрипт, который должен подключаться к mlflow, выгружать модель по её run_id и сохранять ее в файл model.pkl
  
```
docker build . --tag estate_model:0 - команда для создания образа
docker run -p 8001:8000 -v $(pwd)/../models:/models estate_model:0 - команда для запуска контейнера
```
